From 084c293a27d207f816b15ee0335dd297a2d25473 Mon Sep 17 00:00:00 2001
From: Colin Walters <walters@verbum.org>
Date: Tue, 7 Feb 2012 13:53:58 -0500
Subject: [PATCH] build: Add --disable-documentation option

Some operating system builders may not want to build documention, for
example during a bootstrapping process.

Conflicts:
	Makefile
	configure
---
 Makefile  | 9 ++++++++-
 configure | 4 ++++
 2 files changed, 12 insertions(+), 1 deletion(-)

diff --git a/Makefile b/Makefile
index d04d3dd..57431a8 100644
--- a/Makefile
+++ b/Makefile
@@ -10,6 +10,7 @@ pkglibdir ?= ${libdir}/dracut
 sysconfdir ?= ${prefix}/etc
 bindir ?= ${prefix}/bin
 mandir ?= ${prefix}/share/man
+enable_documentation ?= yes
 CFLAGS ?= -O2 -g -Wall
 CFLAGS += -std=gnu99
 
@@ -61,6 +62,10 @@ indent:
 
 doc: $(manpages) dracut.html
 
+ifneq ($(enable_documentation),no)
+all: doc
+endif
+
 %: %.xml
 	xsltproc -o $@ -nonet http://docbook.sourceforge.net/release/xsl/current/manpages/docbook.xsl $<
 
@@ -76,7 +81,7 @@ dracut.html: dracut.asc $(manpages)
 		http://docbook.sourceforge.net/release/xsl/current/xhtml/docbook.xsl dracut.xml
 	rm dracut.xml
 
-install: doc dracut-version.sh
+install: dracut-version.sh
 	mkdir -p $(DESTDIR)$(pkglibdir)
 	mkdir -p $(DESTDIR)$(bindir)
 	mkdir -p $(DESTDIR)$(sysconfdir)
@@ -94,11 +99,13 @@ install: doc dracut-version.sh
 	install -m 0755 dracut-logger.sh $(DESTDIR)$(pkglibdir)/dracut-logger.sh
 	install -m 0755 dracut-initramfs-restore.sh $(DESTDIR)$(pkglibdir)/dracut-initramfs-restore
 	cp -arx modules.d $(DESTDIR)$(pkglibdir)
+ifneq ($(enable_documentation),no)
 	for i in $(man1pages); do install -m 0644 $$i $(DESTDIR)$(mandir)/man1/$${i##*/}; done
 	for i in $(man5pages); do install -m 0644 $$i $(DESTDIR)$(mandir)/man5/$${i##*/}; done
 	for i in $(man7pages); do install -m 0644 $$i $(DESTDIR)$(mandir)/man7/$${i##*/}; done
 	for i in $(man8pages); do install -m 0644 $$i $(DESTDIR)$(mandir)/man8/$${i##*/}; done
 	ln -fs dracut.cmdline.7 $(DESTDIR)$(mandir)/man7/dracut.kernel.7
+endif
 	if [ -n "$(systemdsystemunitdir)" ]; then \
 		mkdir -p $(DESTDIR)$(systemdsystemunitdir); \
 		install -m 0644 dracut-shutdown.service $(DESTDIR)$(systemdsystemunitdir); \
diff --git a/configure b/configure
index 8632398..dfac38b 100755
--- a/configure
+++ b/configure
@@ -7,6 +7,8 @@ echo \#buildapi-variable-no-builddir >/dev/null
 
 prefix=/usr
 
+enable_documentation=yes
+
 # Little helper function for reading args from the commandline.
 # it automatically handles -a b and -a=b variants, and returns 1 if
 # we need to shift $3.
@@ -33,6 +35,7 @@ while (($# > 0)); do
         --sysconfdir) read_arg sysconfdir "$@" || shift;;
         --sbindir) read_arg sbindir "$@" || shift;;
         --mandir) read_arg mandir "$@" || shift;;
+	--disable-documentation) enable_documentation=no;;
         *) echo "Ignoring unknown option '$1'";;
     esac
     shift
@@ -45,5 +48,6 @@ datadir ?= ${datadir:-${prefix}/share}
 sysconfdir ?= ${sysconfdir:-${prefix}/etc}
 sbindir ?= ${sbindir:-${prefix}/sbin}
 mandir ?= ${mandir:-${prefix}/share/man}
+enable_documentation ?= ${enable_documentation}
 EOF
 mv Makefile.inc.tmp Makefile.inc
-- 
1.7.11.4

