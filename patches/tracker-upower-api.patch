From f324465acda10d2e3e9ddd88e541980958f8d222 Mon Sep 17 00:00:00 2001
From: Colin Walters <walters@verbum.org>
Date: Tue, 15 Oct 2013 06:49:55 -0400
Subject: [PATCH] tracker-power-upower: Port to newer UPower API

The old one was removed.
---
 configure.ac                         |    2 +-
 src/miners/fs/tracker-power-upower.c |    4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/configure.ac b/configure.ac
index 29112ce..1a2660f 100644
--- a/configure.ac
+++ b/configure.ac
@@ -168,7 +168,7 @@ GTK_REQUIRED=3.0.0
 LIBXML2_REQUIRED=2.6
 LIBNOTIFY_REQUIRED=0.4.3
 HAL_REQUIRED=0.5
-UPOWER_REQUIRED=0.9.0
+UPOWER_REQUIRED=1.0
 GDKPIXBUF_REQUIRED=2.12.0
 QT_REQUIRED=4.7.1
 MEEGOTOUCH_REQUIRED=0.20
diff --git a/src/miners/fs/tracker-power-upower.c b/src/miners/fs/tracker-power-upower.c
index d3e9406..38afa82 100644
--- a/src/miners/fs/tracker-power-upower.c
+++ b/src/miners/fs/tracker-power-upower.c
@@ -95,7 +95,7 @@ tracker_power_init (TrackerPower *power)
 
 	/* coldplug */
 	priv->on_battery = up_client_get_on_battery (priv->client);
-	priv->on_low_battery = up_client_get_on_low_battery (priv->client);
+	priv->on_low_battery = up_client_get_warning_level (priv->client) >= UP_DEVICE_LEVEL_LOW;
 }
 
 static void
@@ -153,7 +153,7 @@ tracker_power_client_changed_cb (UpClient *client, TrackerPower *power)
 	}
 
 	/* get the on-low-battery state */
-	on_low_battery = up_client_get_on_low_battery (priv->client);
+	on_low_battery = up_client_get_warning_level (priv->client) >= UP_DEVICE_LEVEL_LOW;
 	if (on_low_battery != priv->on_low_battery) {
 		priv->on_low_battery = on_low_battery;
 		g_object_notify (G_OBJECT (power), "on-low-battery");
-- 
1.7.1

